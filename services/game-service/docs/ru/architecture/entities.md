# Игровые сущности (Game Entities)

Этот документ описывает ключевые игровые сущности, их структуру и поведение в `Game Service`.

## 1. Игроки (Players)

Базовый класс `Player` (`app/entities/player.py`) определяет общие характеристики и поведение всех игровых персонажей. Конкретные типы игроков, такие как `Bomberman` и `Tank`, наследуют от него и добавляют свои уникальные свойства.

### 1.1. `Bomberman` (`app/entities/bomberman.py`)

Классический игровой персонаж Bomberman.

*   **Назначение**: Основной управляемый игроком юнит, специализирующийся на размещении бомб.
*   **Основные характеристики**:
    *   `unit_type`: `UnitType.BOMBERMAN`
    *   `scale_size`: `0.8` (относительно размера ячейки)
    *   `primary_weapon`: `WeaponType.BOMB` (основное оружие - бомба)
    *   `primary_weapon_max_count`: `1` (начальное максимальное количество бомб, которые можно разместить одновременно)
    *   `primary_weapon_power`: `1` (начальная сила взрыва бомбы)
    *   `secondary_weapon`: `None` (нет вторичного оружия по умолчанию)

### 1.2. `Tank` (`app/entities/tank.py`)

Игровой персонаж "Танк" (если реализован, в текущих файлах его полная реализация отсутствует, но есть упоминание).

*   **Назначение**: Альтернативный управляемый игроком юнит с, предположительно, другими характеристиками (например, более высокая прочность, другое оружие).
*   **Основные характеристики**:
    *   `unit_type`: `UnitType.TANK`
    *   `scale_size`: Должен быть определен (вероятно, больше Bomberman).
    *   `primary_weapon`: Вероятно, `WeaponType.BULLET` или другое.
    *   `secondary_weapon`: Может быть уникальное вторичное оружие.

## 2. Карта (Map) (`app/entities/map.py`)

Класс `Map` представляет игровую сетку и управляет состоянием ячеек, а также позициями спавна игроков и врагов.

*   **Назначение**: Хранение и управление двухмерной сеткой игрового поля, определение типов ячеек и вспомогательные функции для игровой логики.
*   **Основные свойства**:
    *   `width`: Ширина карты в ячейках.
    *   `height`: Высота карты в ячейках.
    *   `grid`: Двумерный массив NumPy, представляющий сетку карты, где каждая ячейка имеет тип из `CellType`.
    *   `changed_cells`: Список отслеживаемых изменений ячеек, которые нужно отправить клиентам.
*   **Ключевые методы**:
    *   `load_from_template(grid_data: List[List[int]])`: Загружает карту из массива данных.
    *   `get_cell_type(x, y) -> CellType`: Возвращает тип ячейки по координатам.
    *   `set_cell_type(x, y, cell_type: CellType)`: Устанавливает тип ячейки и отслеживает изменения.
    *   `is_wall(x, y)`, `is_breakable_block(x, y)`, `is_solid(x, y)`, `is_empty(x, y)`: Вспомогательные методы для проверки типа ячейки.
    *   `destroy_block(x, y)`: Превращает разрушаемый блок в пустую ячейку.
    *   `get_empty_cells()`: Возвращает список координат пустых ячеек.
    *   `get_player_spawn_positions()`: Возвращает список координат для спавна игроков.
    *   `get_enemy_spawn_positions()`: Возвращает список координат для спавна врагов.
    *   `get_changes()`, `clear_changes()`: Управление списком измененных ячеек.

### 2.1. Типы ячеек (`app/entities/cell_type.py`)

Перечисление `CellType` определяет возможные типы клеток на карте:

*   `EMPTY = 0`: Пустая клетка, по которой можно передвигаться.
*   `SOLID_WALL = 1`: Твердая стена, которую нельзя разрушить.
*   `BREAKABLE_BLOCK = 2`: Разрушаемый блок, который можно уничтожить взрывом.
*   `PLAYER_SPAWN = 3`: Точка появления игрока.
*   `ENEMY_SPAWN = 4`: Точка появления врага.

## 3. Игровые режимы (Game Modes) (`app/entities/game_mode.py`)

Перечисление `GameModeType` определяет доступные игровые режимы:

*   `CAMPAIGN = "CAMPAIGN"`: Режим прохождения, ориентированный на PVE (игроки против окружения) с возможностью кооператива.
*   `FREE_FOR_ALL = "FREE_FOR_ALL"`: Режим "каждый сам за себя", где каждый игрок соревнуется индивидуально.
*   `CAPTURE_THE_FLAG = "CAPTURE_THE_FLAG"`: Командный режим, где цель - захватить флаг противника.

(Подробная логика каждого режима реализована в `app/services/modes/`.)

## 4. Оружие (Weapons) (`app/entities/weapon.py`)

*   **`WeaponType`**: Перечисление типов оружия (`BOMB`, `BULLET`, `MINE`).
*   **`WeaponAction`**: Перечисление возможных действий с оружием (`PLACEWEAPON1`, `PLACEWEAPON2`, `ACTIVATEWEAPON1`, `ACTIVATEWEAPON2`).
*   **`Weapon`**: Базовый класс для всех видов оружия, определяющий общие свойства и поведение (взрывы, столкновения).

## 5. Враги (Enemies) (`app/entities/enemy.py`)

*   **`EnemyType`**: Перечисление типов врагов (например, `BALLOOM`, `ONEAL`, `DAQAN`).
*   **`Enemy`**: Базовый класс для всех врагов с общими свойствами и поведением (перемещение, взаимодействие с игроком).

## 6. Усиления (Power-Ups) (`app/entities/power_up.py`)

*   **`PowerUpType`**: Перечисление типов усилений (например, `BOMB_UP`, `FIRE_UP`, `SPEED_UP`, `PIERCE_BOMB`, `IMMUNITY`).
*   **`PowerUp`**: Базовый класс для всех усилений, определяющий их эффекты на игроков. 