# 7. Управление миграциями базы данных

Для управления изменениями схемы базы данных используется Alembic. Процесс создания и применения миграций автоматизирован с помощью команд.

## Конфигурация

Основной конфигурационный файл Alembic - `alembic.ini`. Он настроен на работу с директорией `app/alembic`.

## Создание новой миграции

Когда вы вносите изменения в модели SQLAlchemy в директории `app/models`, Alembic может автоматически сгенерировать файл миграции, отражающий эти изменения.

Для этого можно использовать команду из `app/manage.py`:

```bash
# Убедитесь, что ваше виртуальное окружение активировано
python app/manage.py makemigrations --name "Краткое описание миграции"
```

Или выполнить команду Alembic напрямую:

```bash
alembic revision --autogenerate -m "Краткое описание миграции"
```

Будет создан новый файл в `app/alembic/versions/`.

## Применение миграций

Чтобы применить все последние миграции к базе данных, используйте команду:

```bash
python app/manage.py migrate
```

Или напрямую через Alembic:

```bash
alembic upgrade head
```

## Откат миграций

Для отката последней примененной миграции:

```bash
alembic downgrade -1
```

Чтобы откатиться до определенной версии, укажите ее хэш:

```bash
alembic downgrade <revision_hash>
```

## Просмотр истории миграций

Чтобы увидеть всю историю миграций и текущую версию базы данных:

```bash
alembic history --verbose
```

Чтобы увидеть только текущую активную миграцию:

```bash
alembic current
```
