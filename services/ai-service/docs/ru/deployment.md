# Развертывание и запуск
[![English](https://img.shields.io/badge/lang-English-blue)](../en/deployment.md)

## Локальный запуск (для разработки)

Этот способ подходит для локальной разработки и отладки.

1.  **Установка зависимостей**:
    Убедитесь, что у вас установлен `uv`. Затем, находясь в директории `services/ai-service`, выполните:
    ```bash
    uv sync
    ```

2.  **Запуск приложения**:
    Для запуска сервиса необходимо, чтобы были доступны запущенные экземпляры NATS и Redis.
    ```bash
    uvicorn app.main:app --host 0.0.0.0 --port 5004 --reload
    ```
    Флаг `--reload` автоматически перезапускает сервис при изменении кода.

## Запуск с использованием Docker

Этот способ является рекомендуемым для интеграции и развертывания.

### Сборка образа

Находясь в корневой директории сервиса (`services/ai-service`), выполните команду:
```bash
docker build -t bomberman-ai-service .
```

### Анализ Dockerfile

```dockerfile
# Используем официальный образ Python 3.12
FROM python:3.12-slim-bookworm

# Устанавливаем рабочую директорию внутри контейнера
WORKDIR /app

# Устанавливаем uv для управления зависимостями
RUN pip install uv

# Копируем файлы с зависимостями
COPY pyproject.toml uv.lock ./

# Устанавливаем зависимости с помощью uv
RUN uv sync

# Копируем исходный код приложения
COPY app ./app

# Команда по умолчанию для запуска FastAPI приложения
CMD ["uvicorn", "app.main:app", "--host", "0.0.0.0", "--port", "5004"]
```

### Запуск контейнера

Для полноценного запуска сервиса в Docker, его необходимо интегрировать в общую `docker-compose.yml` инфраструктуру проекта, чтобы обеспечить взаимодействие с другими сервисами, такими как `game-service`, `NATS` и `Redis`.

Пример команды для ручного запуска контейнера:
```bash
docker run -p 5004:5004 \
       --network=bomberman-network \
       --env-file .env \
       -v ./infra/ai_models:/app/ai_models \
       -v ./infra/ai_logs:/app/ai_logs \
       bomberman-ai-service
```
```
*   `--network`: Подключает контейнер к той же Docker-сети, что и остальные сервисы.
*   `--env-file`: Передает переменные окружения из файла `.env`.
*   `-v`: Пробрасывает локальные директории `infra/ai_models` и `infra/ai_logs` внутрь контейнера для сохранения моделей и логов обучения.

```