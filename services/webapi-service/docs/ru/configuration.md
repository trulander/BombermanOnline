# Конфигурация
[![English](https://img.shields.io/badge/lang-English-blue)](../en/configuration.md)

Сервис `WebAPI Service` настраивается с помощью переменных окружения. Для удобства разработки можно использовать файл `.env` в корневой директории сервиса. Файл `.env-example` предоставляет шаблон для всех необходимых переменных.

## Управление секретами (Infisical)

В Docker-режиме секреты подставляются через Infisical. Для entrypoint требуются:

- `INFISICAL_MACHINE_CLIENT_ID`
- `INFISICAL_MACHINE_CLIENT_SECRET`
- `INFISICAL_PROJECT_ID`
- `INFISICAL_SECRET_ENV`
- `INFISICAL_API_URL`
- `INFISICAL_PATH`

Файл `services/webapi-service/.env-example` можно импортировать в Infisical для базовой конфигурации.

## Основные переменные

| Переменная              | Описание                                                              | Значение по умолчанию (`config.py`) |
| :---------------------- | :-------------------------------------------------------------------- | :---------------------------------- |
| `SERVICE_NAME`          | Имя сервиса, используемое при регистрации в Consul.                   | `webapi-service`                    |
| `API_V1_STR`            | Префикс URL для всех эндпоинтов API v1.                               | `/webapi/api/v1`                    |
| `APP_TITLE`             | Заголовок приложения, отображаемый в Swagger UI.                      | `Bomberman WebAPI Service`          |
| `HOST`                  | Хост, на котором запускается FastAPI приложение.                      | `0.0.0.0`                           |
| `PORT`                  | Порт, на котором запускается FastAPI приложение.                      | `5001`                              |
| `DEBUG`                 | Включает/выключает режим отладки FastAPI.                             | `True`                              |
| `RELOAD`                | Включает/выключает автоматическую перезагрузку Uvicorn при изменении кода. | `True`                              |
| `SWAGGER_URL`           | URL для доступа к Swagger UI документации.                            | `/webapi/docs`                      |
| `HOSTNAME`              | Имя хоста, используемое для внутренних коммуникаций.                  | `localhost`                         |

## Настройки CORS

| Переменная              | Описание                                                              | Значение по умолчанию (`config.py`) | 
| :---------------------- | :-------------------------------------------------------------------- | :---------------------------------- |
| `CORS_ORIGINS`          | Список разрешенных источников (origins) для CORS.                     | `*` (все источники)                 |
| `CORS_CREDENTIALS`      | Разрешает ли CORS передачу credentials (например, cookie).            | `True`                              |
| `CORS_METHODS`          | Список разрешенных HTTP методов для CORS.                             | `["*"]` (все методы)              |
| `CORS_HEADERS`          | Список разрешенных HTTP заголовков для CORS.                          | `["*"]` (все заголовки)           |

## Настройки подключений

### Redis

| Переменная              | Описание                                                              | Значение по умолчанию (`config.py`) | 
| :---------------------- | :-------------------------------------------------------------------- | :---------------------------------- |
| `REDIS_HOST`            | Хост сервера Redis.                                                   | `localhost`                         |
| `REDIS_PORT`            | Порт сервера Redis.                                                   | `6379`                              |
| `REDIS_DB`              | Номер базы данных Redis.                                              | `0`                                 |
| `REDIS_PASSWORD`        | Пароль для подключения к Redis (если требуется).                      | `None`                              |

### NATS

| Переменная              | Описание                                                              | Значение по умолчанию (`config.py`) | 
| :---------------------- | :-------------------------------------------------------------------- | :---------------------------------- |
| `NATS_URL`              | URL для подключения к NATS серверу.                                   | `nats://localhost:4222`             |

### Consul

| Переменная              | Описание                                                              | Значение по умолчанию (`config.py`) | 
| :---------------------- | :-------------------------------------------------------------------- | :---------------------------------- |
| `CONSUL_HOST`           | Хост Consul для обнаружения сервисов.                                 | `localhost`                         |

## Настройки логирования

| Переменная              | Описание                                                              | Значение по умолчанию (`config.py`) | 
| :---------------------- | :-------------------------------------------------------------------- | :---------------------------------- |
| `LOG_LEVEL`             | Уровень логирования (DEBUG, INFO, WARNING, ERROR, CRITICAL).          | `INFO`                              |
| `LOG_FORMAT`            | Формат логов (`text` или `json`).                                     | `text`                              |
| `TRACE_CALLER`          | Включает ли добавление информации о файле и строке вызова в JSON логи. | `True`                              |
