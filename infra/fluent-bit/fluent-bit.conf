[SERVICE]
    Flush            5
    Log_Level        info
    Daemon           off
    HTTP_Server      on
    HTTP_Listen      0.0.0.0
    HTTP_Port        2020
    Parsers_File     parsers.conf

# HTTP вход для логов с фронтенда
[INPUT]
    Name        http
    Host        0.0.0.0
    Port        8888
    Tag         frontend

# Forward вход для логов из Docker
[INPUT]
    Name        forward
    Host        0.0.0.0
    Port        24224
    Tag         docker

# Фильтр для парсинга JSON-логов с фронтенда
[FILTER]
    Name parser
    Match frontend
    Key_Name log
    Parser frontend_json
    Reserve_Data true
    Preserve_Key false

# Выход для логов в Loki
[OUTPUT]
    Name loki
    Match *
    Host loki
    Port 3100
    Labels job="fluentbit"
    Label_Keys $level,$service
    Remove_Keys timestamp,level,service

# Отдельный выход для фронтенда с уникальными метками
[OUTPUT]
    Name loki
    Match frontend
    Host loki
    Port 3100
    Labels job="web-frontend", component="frontend"
    Remove_Keys timestamp

# Отдельный выход для Docker-логов с метками из контейнера
[OUTPUT]
    Name loki
    Match docker
    Host loki
    Port 3100
    Labels job="docker"
    Label_Keys $container_name,$container_id 